<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- HilltopAds Verification Code -->
    <meta name="890d62df10c213f65bd613ee1c9c220332a3d1d9" content="890d62df10c213f65bd613ee1c9c220332a3d1d9" />
    <title>Gmail Father - Light Green Edition</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&family=Manrope:wght@400;500;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#34d399", // Lighter Emerald Green
                        "primary-dark": "#10b981",
                        "accent-gold": "#fbbf24",
                        "background-light": "#ffffff",
                        "surface-light": "#f0fdfa", 
                        "border-light": "#ccfbf1",
                    },
                    fontFamily: {
                        "display": ["Manrope", "Hind Siliguri", "sans-serif"]
                    }
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        body {
            font-family: 'Manrope', 'Hind Siliguri', sans-serif;
            -webkit-tap-highlight-color: transparent;
            background-color: #ffffff;
        }
        .ios-blur {
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }
        .green-gradient {
            background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
        }
        .animate-shake {
            animation: shake 0.2s ease-in-out 0s 2;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .view-section { display: none; }
        .view-active { display: flex; flex-direction: column; }
    </style>
</head>
<body class="bg-white text-slate-900 min-h-screen">

    <!-- লোডিং স্ক্রিন -->
    <div id="loading-screen" class="fixed inset-0 z-[100] bg-white flex items-center justify-center">
        <div class="flex flex-col items-center gap-4">
            <div class="w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin"></div>
            <p class="text-primary text-xs font-bold uppercase tracking-widest">Gmail Father</p>
        </div>
    </div>

    <!-- অথেনটিকেশন কন্টেইনার -->
    <div id="auth-shell" class="hidden min-h-screen flex flex-col items-center justify-center p-6 bg-surface-light">
        <div class="w-full max-w-[420px] space-y-8">
            <div class="text-center space-y-4">
                <div class="w-24 h-24 mx-auto rounded-3xl overflow-hidden shadow-xl border-4 border-white relative">
                    <img src="https://i.ibb.co.com/rKc5Qm12/photo-2026-02-20-02-46-22.jpg" alt="Logo" class="w-full h-full object-cover">
                </div>
                <h1 class="text-3xl font-black tracking-tight text-primary">Gmail Father</h1>
                <p class="text-slate-500 text-sm font-medium">প্রিমিয়াম অ্যাকাউন্ট ক্রিয়েশন টুল</p>
            </div>

            <div class="bg-white p-8 rounded-[2.5rem] shadow-2xl border border-border-light">
                <h2 id="auth-title" class="text-2xl font-bold text-center mb-8 text-slate-800">লগইন করুন</h2>
                
                <div id="auth-error" class="hidden mb-6 p-4 bg-red-50 border border-red-100 rounded-xl text-red-600 text-sm flex gap-2 animate-shake">
                    <i data-lucide="alert-circle" class="shrink-0 w-5 h-5"></i>
                    <p id="error-message"></p>
                </div>

                <form id="auth-form" class="space-y-5">
                    <div id="signup-fields" class="hidden space-y-2">
                        <label class="text-xs font-bold uppercase text-slate-400 ml-1">আপনার নাম</label>
                        <div class="relative group">
                            <i data-lucide="user" class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-primary w-5 h-5"></i>
                            <input id="auth-name" type="text" class="w-full h-14 pl-12 pr-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all" placeholder="নাম লিখুন">
                        </div>
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs font-bold uppercase text-slate-400 ml-1">ইমেইল ঠিকানা</label>
                        <div class="relative group">
                            <i data-lucide="mail" class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-primary w-5 h-5"></i>
                            <input id="auth-email" type="email" required class="w-full h-14 pl-12 pr-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all" placeholder="example@mail.com">
                        </div>
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs font-bold uppercase text-slate-400 ml-1">পাসওয়ার্ড</label>
                        <div class="relative group">
                            <i data-lucide="lock" class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-primary w-5 h-5"></i>
                            <input id="auth-password" type="password" required class="w-full h-14 pl-12 pr-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all" placeholder="••••••••">
                            <button type="button" onclick="window.togglePassword()" class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-primary">
                                <i id="eye-icon" data-lucide="eye" class="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>
                    <button type="submit" id="auth-submit-btn" class="w-full h-14 green-gradient text-white font-bold rounded-2xl shadow-lg shadow-primary/30 transition-all flex items-center justify-center gap-2 active:scale-95">
                        <span id="auth-btn-text">প্রবেশ করুন</span>
                        <i data-lucide="log-in" class="w-5 h-5"></i>
                    </button>
                </form>

                <div class="mt-8 text-center">
                    <button onclick="window.toggleAuthMode()" id="auth-toggle-btn" class="text-sm font-bold text-slate-500 hover:text-primary transition-colors">
                        অ্যাকাউন্ট নেই? সাইন আপ করুন
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- মেইন অ্যাপ সেল -->
    <div id="app-shell" class="hidden min-h-screen flex flex-col relative overflow-hidden bg-white">
        
        <!-- হেডার -->
        <header id="main-header" class="px-6 py-4 flex items-center justify-between sticky top-0 z-50 bg-white/90 backdrop-blur-xl border-b border-slate-100">
            <div class="flex items-center gap-2">
                <div class="w-10 h-10 rounded-xl overflow-hidden shadow-md border border-primary/20 bg-white">
                    <img src="https://i.ibb.co.com/rKc5Qm12/photo-2026-02-20-02-46-22.jpg" alt="Logo" class="w-full h-full object-cover">
                </div>
                <div>
                    <h1 class="text-base font-black tracking-tight leading-none text-slate-800">Gmail Father</h1>
                    <span class="text-[10px] font-bold text-primary uppercase tracking-widest">প্রো ইউজার</span>
                </div>
            </div>
            <div class="flex items-center gap-2 bg-primary/5 px-3 py-2 rounded-2xl border border-primary/10">
                <i data-lucide="coins" class="w-4 h-4 text-primary fill-current"></i>
                <span id="header-credits" class="text-sm font-black text-primary">0</span>
            </div>
        </header>

        <main id="main-content" class="flex-1 overflow-y-auto">
            
            <!-- ব্রাউজার ভিউ -->
            <div id="view-browser" class="view-section items-center justify-center px-6 py-12">
                <div class="mb-10 relative">
                    <div class="absolute inset-0 bg-primary/10 blur-[80px] rounded-full"></div>
                    <div class="relative w-60 h-60 bg-white rounded-full flex items-center justify-center border border-primary/10 shadow-2xl overflow-hidden group">
                        <div class="absolute inset-0 opacity-5" style="background-image: radial-gradient(circle at 2px 2px, #34d399 1px, transparent 0); background-size: 20px 20px;"></div>
                        <div class="flex flex-col items-center">
                            <i data-lucide="globe" class="text-primary w-20 h-20 mb-2 drop-shadow-lg"></i>
                            <div class="flex gap-1.5">
                                <span class="w-2 h-2 rounded-full bg-primary animate-bounce" style="animation-delay: 0s"></span>
                                <span class="w-2 h-2 rounded-full bg-primary/40 animate-bounce" style="animation-delay: 0.2s"></span>
                                <span class="w-2 h-2 rounded-full bg-primary/20 animate-bounce" style="animation-delay: 0.4s"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="text-center mb-10 space-y-6 max-w-xs">
                    <div class="space-y-1">
                        <h2 class="text-3xl font-black tracking-tight text-slate-800">তৈরি তো?</h2>
                        <p class="text-slate-500 text-sm font-medium">জিমেইল ক্রিয়েট করতে নিচের বাটনে ক্লিক করে ব্রাউজার খুলুন।</p>
                    </div>
                </div>
                <button class="w-full max-w-sm green-gradient text-white py-5 rounded-3xl shadow-xl shadow-primary/20 flex items-center justify-center gap-3 active:scale-95 font-bold text-lg">
                    <span>ব্রাউজার ওপেন করুন</span>
                    <i data-lucide="external-link" class="w-6 h-6"></i>
                </button>
            </div>

            <!-- হোম (অ্যাড সেন্টার) ভিউ -->
            <div id="view-home" class="view-section px-6 py-8">
                <div class="green-gradient rounded-[2.5rem] p-8 flex flex-col items-center text-center relative overflow-hidden text-white shadow-2xl shadow-primary/30">
                    <div class="absolute -right-8 -top-8 opacity-10 rotate-12"><i data-lucide="database" class="w-48 h-48"></i></div>
                    <p class="text-[10px] font-black text-white/60 uppercase tracking-[0.3em] mb-2">মোট ব্যালেন্স</p>
                    <div class="flex items-center gap-3">
                        <span id="home-credits" class="text-6xl font-black tracking-tighter">0</span>
                        <div class="bg-white/20 p-2 rounded-xl backdrop-blur-md border border-white/20">
                            <i data-lucide="zap" class="text-white w-6 h-6 fill-current"></i>
                        </div>
                    </div>
                </div>

                <div class="mt-12 text-center relative">
                    <h2 class="text-xs font-black uppercase tracking-[0.2em] text-slate-400 mb-6">ভিআইপি অ্যাড সেন্টার</h2>
                    <div class="relative w-full max-w-[280px] mx-auto">
                        <button onclick="window.handleWatchAd()" id="watch-ad-btn" class="relative w-full aspect-square rounded-full border-8 border-slate-50 bg-white flex flex-col items-center justify-center gap-3 shadow-2xl transition-all active:scale-95 overflow-hidden group">
                            <div class="bg-primary/10 p-5 rounded-full mb-2 group-hover:bg-primary/20 transition-colors">
                                <i data-lucide="play" class="text-primary w-12 h-12 fill-current"></i>
                            </div>
                            <span class="text-slate-800 font-black text-xl tracking-tight">ভিডিও দেখুন</span>
                            <span class="text-primary font-bold text-[11px] uppercase tracking-widest">+১০ ক্রেডিট</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- লিডারবোর্ড ভিউ -->
            <div id="view-leaderboard" class="view-section">
                <div class="px-6 pt-8 pb-4">
                    <h1 class="text-2xl font-black text-center mb-6 text-slate-800">লিডারবোর্ড</h1>
                    <div class="flex p-1.5 bg-slate-100 rounded-2xl mb-8 border border-slate-200">
                        <button class="flex-1 py-3 text-xs font-black uppercase rounded-xl text-slate-400">দৈনিক</button>
                        <button class="flex-1 py-3 text-xs font-black uppercase rounded-xl bg-white text-primary shadow-md">সাপ্তাহিক</button>
                        <button class="flex-1 py-3 text-xs font-black uppercase rounded-xl text-slate-400">সর্বকালীন</button>
                    </div>
                </div>

                <!-- পোডিয়াম -->
                <div class="px-6 pb-10 flex items-end justify-center gap-3">
                    <!-- ২য় -->
                    <div class="flex flex-col items-center flex-1">
                        <div class="relative mb-2">
                            <span class="absolute -top-3 left-1/2 -translate-x-1/2 bg-slate-300 text-white text-[10px] font-black px-2 py-0.5 rounded-full">#2</span>
                            <div class="w-16 h-16 rounded-full border-4 border-slate-100 overflow-hidden shadow-lg">
                                <img src="https://i.pravatar.cc/150?u=2" class="w-full h-full object-cover" alt="User">
                            </div>
                        </div>
                        <p class="text-[10px] font-bold truncate w-20 text-center text-slate-700">শফিক_০৭</p>
                        <p class="text-[10px] text-primary font-black">৮৪,২০০</p>
                    </div>
                    <!-- ১ম -->
                    <div class="flex flex-col items-center flex-1 scale-125 -mt-6">
                        <div class="relative mb-2">
                            <i data-lucide="crown" class="absolute -top-6 left-1/2 -translate-x-1/2 text-primary w-8 h-8 fill-current"></i>
                            <div class="w-20 h-20 rounded-full border-4 border-primary shadow-2xl overflow-hidden ring-4 ring-primary/10">
                                <img src="https://i.pravatar.cc/150?u=1" class="w-full h-full object-cover" alt="User">
                            </div>
                        </div>
                        <p class="text-[10px] font-black text-primary uppercase">রাইহান খান</p>
                        <p class="text-[10px] text-slate-800 font-black">১,২৫,০০০</p>
                    </div>
                    <!-- ৩য় -->
                    <div class="flex flex-col items-center flex-1">
                        <div class="relative mb-2">
                            <span class="absolute -top-3 left-1/2 -translate-x-1/2 bg-primary/20 text-primary text-[10px] font-black px-2 py-0.5 rounded-full">#3</span>
                            <div class="w-16 h-16 rounded-full border-4 border-slate-100 overflow-hidden shadow-lg">
                                <img src="https://i.pravatar.cc/150?u=3" class="w-full h-full object-cover" alt="User">
                            </div>
                        </div>
                        <p class="text-[10px] font-bold truncate w-20 text-center text-slate-700">আবির_বিডি</p>
                        <p class="text-[10px] text-primary font-black">৭২,৫০০</p>
                    </div>
                </div>

                <!-- ইউজার লিস্ট -->
                <div id="leaderboard-list" class="px-6 space-y-3 pb-44">
                    <!-- ১০০ জন ডেমো ইউজার লোড হবে -->
                </div>
            </div>

            <!-- প্রোফাইল ভিউ -->
            <div id="view-profile" class="view-section px-6 py-8">
                <div class="flex flex-col items-center mb-8">
                    <div class="relative mb-6">
                        <div class="w-32 h-32 rounded-3xl p-1 green-gradient shadow-2xl">
                            <div class="w-full h-full rounded-[1.25rem] border-4 border-white overflow-hidden bg-slate-100 flex items-center justify-center">
                                <img src="https://i.ibb.co.com/rKc5Qm12/photo-2026-02-20-02-46-22.jpg" alt="Profile" class="w-full h-full object-cover">
                            </div>
                        </div>
                        <div class="absolute -bottom-3 left-1/2 -translate-x-1/2 green-gradient text-white text-[10px] font-black px-5 py-1.5 rounded-full uppercase tracking-widest shadow-xl border-2 border-white">
                            LEVEL <span id="profile-level">24</span>
                        </div>
                    </div>
                    <h2 id="profile-name" class="text-2xl font-black tracking-tight text-slate-800 text-center">...</h2>
                    <p id="profile-email" class="text-slate-400 font-bold text-[10px] uppercase tracking-widest text-center mt-1">EMAIL@EXAMPLE.COM</p>
                </div>

                <div class="bg-slate-50 rounded-[2.5rem] p-8 border border-slate-100 relative overflow-hidden mb-10 text-center">
                    <div class="relative z-10 grid grid-cols-2 divide-x divide-slate-200">
                        <div class="pr-4 text-center">
                            <p class="text-[9px] uppercase font-black text-slate-400 tracking-widest mb-2">ক্রেডিট</p>
                            <div class="flex items-center justify-center gap-2">
                                <i data-lucide="database" class="text-primary w-4 h-4 fill-current"></i>
                                <p id="stats-credits" class="text-xl font-black text-slate-800">0</p>
                            </div>
                        </div>
                        <div class="pl-4 text-center">
                            <p class="text-[9px] uppercase font-black text-slate-400 tracking-widest mb-2">অ্যাড ওয়াচ</p>
                            <div class="flex items-center justify-center gap-2">
                                <i data-lucide="play-circle" class="text-slate-800 w-4 h-4"></i>
                                <p id="stats-ads" class="text-xl font-black text-slate-800">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="bg-white rounded-3xl border border-slate-100 overflow-hidden shadow-sm">
                        <button class="w-full flex items-center gap-4 p-5 hover:bg-slate-50 transition-colors border-b border-slate-50">
                            <div class="w-11 h-11 rounded-2xl bg-primary/5 text-primary flex items-center justify-center shadow-inner"><i data-lucide="settings" class="w-5 h-5"></i></div>
                            <div class="flex-1 text-left font-black text-xs uppercase tracking-widest">সেটিংস</div>
                            <i data-lucide="chevron-right" class="text-slate-200 w-5 h-5"></i>
                        </button>
                        <button class="w-full flex items-center gap-4 p-5 hover:bg-slate-50 transition-colors">
                            <div class="w-11 h-11 rounded-2xl bg-primary/5 text-primary flex items-center justify-center"><i data-lucide="share-2" class="w-5 h-5"></i></div>
                            <div class="flex-1 text-left font-black text-xs uppercase tracking-widest">রেফার করুন</div>
                            <i data-lucide="chevron-right" class="text-slate-200 w-5 h-5"></i>
                        </button>
                    </div>

                    <button onclick="window.handleLogout()" class="w-full py-5 rounded-3xl flex items-center justify-center gap-3 text-red-500 bg-red-50 font-black uppercase tracking-[0.2em] text-[10px] hover:bg-red-100 transition-all active:scale-95 border border-red-100 shadow-sm">
                        <i data-lucide="power" class="w-4 h-4"></i>
                        <span>লগআউট করুন</span>
                    </button>
                </div>
            </div>
        </main>

        <!-- র‍্যাঙ্ক ব্যানার (ইউজার পজিশন) -->
        <div id="rank-banner" class="hidden fixed bottom-[95px] left-0 right-0 px-4 z-40">
            <div class="p-5 rounded-[2rem] bg-white text-slate-800 shadow-2xl flex items-center justify-between border border-slate-100 ring-4 ring-slate-50/50">
                <div class="flex items-center gap-4">
                    <div class="relative">
                        <div class="w-14 h-14 rounded-2xl border-2 border-primary/20 overflow-hidden bg-slate-100">
                            <img src="https://i.ibb.co.com/rKc5Qm12/photo-2026-02-20-02-46-22.jpg" class="object-cover w-full h-full" alt="Avatar">
                        </div>
                        <div class="absolute -bottom-2 -right-2 green-gradient text-white text-[10px] font-black w-7 h-7 flex items-center justify-center rounded-xl border-4 border-white shadow-lg">#12</div>
                    </div>
                    <div>
                        <p class="text-[9px] font-black text-slate-400 uppercase tracking-widest leading-none mb-1">আপনার অবস্থান</p>
                        <p id="banner-name" class="font-black text-sm truncate w-32 text-slate-800 uppercase">USER</p>
                    </div>
                </div>
                <div class="text-right">
                    <p id="banner-credits" class="text-primary font-black text-xl tracking-tighter">0</p>
                    <p class="text-[9px] text-slate-400 uppercase font-black">ক্রেডিট</p>
                </div>
            </div>
        </div>

        <!-- নেভিগেশন বার -->
        <nav class="fixed bottom-0 w-full bg-white/95 border-t border-slate-100 px-6 pt-4 pb-10 backdrop-blur-xl z-50 flex justify-around shadow-[0_-10px_40px_rgba(0,0,0,0.05)]">
            <button onclick="window.showView('home')" class="nav-btn flex flex-col items-center gap-1.5 text-slate-300 group" data-view="home">
                <i data-lucide="zap" class="w-6 h-6"></i>
                <span class="text-[9px] font-black uppercase tracking-widest text-center">Earn</span>
            </button>
            <button onclick="window.showView('browser')" class="nav-btn flex flex-col items-center gap-1.5 text-slate-300 group" data-view="browser">
                <i data-lucide="layout-grid" class="w-6 h-6"></i>
                <span class="text-[9px] font-black uppercase tracking-widest text-center">Browser</span>
            </button>
            <button onclick="window.showView('leaderboard')" class="nav-btn flex flex-col items-center gap-1.5 text-slate-300 group" data-view="leaderboard">
                <i data-lucide="trophy" class="w-6 h-6"></i>
                <span class="text-[9px] font-black uppercase tracking-widest text-center">Rank</span>
            </button>
            <button onclick="window.showView('profile')" class="nav-btn flex flex-col items-center gap-1.5 text-slate-300 group" data-view="profile">
                <i data-lucide="user" class="w-6 h-6"></i>
                <span class="text-[9px] font-black uppercase tracking-widest text-center">User</span>
            </button>
        </nav>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, updateProfile, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAmtDEw41p1POsK-8qWQM_f3PzBFjFBHxc",
            authDomain: "gen-lang-client-0199662561.firebaseapp.com",
            databaseURL: "https://gen-lang-client-0199662561-default-rtdb.firebaseio.com",
            projectId: "gen-lang-client-0199662561",
            storageBucket: "gen-lang-client-0199662561.firebasestorage.app",
            messagingSenderId: "940475130557",
            appId: "1:940475130557:web:486451c872fdff0abecdd4",
            measurementId: "G-488L7913ES"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const fbAppId = "gmail-father-v2";

        let isSignupMode = false;

        // ডেমো ইউজার জেনারেটর (১০০ জন)
        const generateDemoUsers = () => {
            const names = ["Abir", "Rifat", "Sujon", "Hridoy", "Nila", "Sumaiya", "Tarek", "Faysal", "Mim", "Sakib", "Joy", "Isha", "Milon", "Tanvir", "Sonia", "Kajal", "Imran", "Arif", "Nasir", "Sabina", "Emon", "Rakib", "Faruk", "Bristi", "Jannat"];
            const list = document.getElementById('leaderboard-list');
            list.innerHTML = "";

            let demoData = [];
            for (let i = 4; i <= 100; i++) {
                const name = names[Math.floor(Math.random() * names.length)] + "_" + Math.floor(Math.random() * 999);
                const credits = 70000 - (i * 650) + Math.floor(Math.random() * 300);
                demoData.push({ rank: i, name: name, credits: credits });
            }

            demoData.forEach(user => {
                const item = document.createElement('div');
                item.className = "flex items-center p-5 rounded-2xl bg-white border border-slate-100 shadow-sm transition-all";
                item.innerHTML = `
                    <span class="text-sm font-black text-slate-400 w-10">${user.rank < 10 ? '0' + user.rank : user.rank}</span>
                    <div class="w-11 h-11 rounded-xl bg-slate-100 mr-4 overflow-hidden border border-slate-50">
                        <img src="https://i.pravatar.cc/100?u=${user.rank}" class="object-cover w-full h-full" alt="Avatar">
                    </div>
                    <div class="flex-1">
                        <p class="font-black text-[11px] uppercase tracking-tight text-slate-700">${user.name}</p>
                        <p class="text-[10px] font-bold text-primary uppercase">${user.credits.toLocaleString()} ক্রেডিট</p>
                    </div>
                    <div class="bg-primary/5 p-2 rounded-lg">
                        <i data-lucide="trending-up" class="w-4 h-4 text-primary"></i>
                    </div>
                `;
                list.appendChild(item);
            });
            lucide.createIcons();
        };

        window.showView = (viewName) => {
            document.querySelectorAll('.view-section').forEach(v => v.classList.remove('view-active'));
            const target = document.getElementById(`view-${viewName}`);
            if (target) target.classList.add('view-active');
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                const isActive = btn.dataset.view === viewName;
                btn.classList.toggle('text-primary', isActive);
                btn.classList.toggle('text-slate-300', !isActive);
            });

            document.getElementById('rank-banner').classList.toggle('hidden', viewName !== 'leaderboard');
            document.getElementById('main-header').classList.toggle('hidden', viewName === 'leaderboard');
            
            if(viewName === 'leaderboard') generateDemoUsers();
            lucide.createIcons();
        };

        window.toggleAuthMode = () => {
            isSignupMode = !isSignupMode;
            document.getElementById('auth-title').textContent = isSignupMode ? 'অ্যাকাউন্ট তৈরি করুন' : 'লগইন করুন';
            document.getElementById('auth-btn-text').textContent = isSignupMode ? 'সাইন আপ' : 'প্রবেশ করুন';
            document.getElementById('auth-toggle-btn').textContent = isSignupMode ? 'ইতিমধ্যে অ্যাকাউন্ট আছে? লগইন করুন' : "অ্যাকাউন্ট নেই? সাইন আপ করুন";
            document.getElementById('signup-fields').classList.toggle('hidden', !isSignupMode);
        };

        window.togglePassword = () => {
            const input = document.getElementById('auth-password');
            const icon = document.getElementById('eye-icon');
            const isPassword = input.type === 'password';
            input.type = isPassword ? 'text' : 'password';
            icon.setAttribute('data-lucide', isPassword ? 'eye-off' : 'eye');
            lucide.createIcons();
        };

        const syncUserData = (user) => {
            const userDocRef = doc(db, 'artifacts', fbAppId, 'users', user.uid, 'profile', 'info');
            onSnapshot(userDocRef, (snap) => {
                if (snap.exists()) {
                    const data = snap.data();
                    const credits = Number(data.credits || 0);
                    document.getElementById('header-credits').textContent = credits.toLocaleString();
                    document.getElementById('home-credits').textContent = credits.toLocaleString();
                    document.getElementById('stats-credits').textContent = credits.toLocaleString();
                    document.getElementById('stats-ads').textContent = data.adsWatched || 0;
                    document.getElementById('profile-level').textContent = data.level || 24;
                    document.getElementById('profile-name').textContent = (data.fullName || user.displayName || 'G-Father User');
                    document.getElementById('profile-email').textContent = (user.email || '');
                    document.getElementById('banner-name').textContent = (data.fullName || 'User');
                    document.getElementById('banner-credits').textContent = credits.toLocaleString();
                }
            }, (err) => console.error("Sync error:", err));
        };

        window.handleAuth = async (e) => {
            e.preventDefault();
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            const nameInput = document.getElementById('auth-name');
            const name = nameInput ? nameInput.value : '';
            const errorBox = document.getElementById('auth-error');
            const submitBtn = document.getElementById('auth-submit-btn');

            errorBox.classList.add('hidden');
            submitBtn.disabled = true;
            submitBtn.innerHTML = `<div class="w-6 h-6 border-4 border-white/20 border-t-white rounded-full animate-spin mx-auto"></div>`;

            try {
                if (isSignupMode) {
                    const cred = await createUserWithEmailAndPassword(auth, email, password);
                    await updateProfile(cred.user, { displayName: name });
                    const userDocRef = doc(db, 'artifacts', fbAppId, 'users', cred.user.uid, 'profile', 'info');
                    await setDoc(userDocRef, {
                        fullName: name,
                        email: email,
                        credits: 150,
                        adsWatched: 0,
                        level: 1,
                        createdAt: new Date().toISOString()
                    });
                } else {
                    await signInWithEmailAndPassword(auth, email, password);
                }
            } catch (err) {
                errorBox.classList.remove('hidden');
                document.getElementById('error-message').textContent = "ইমেইল বা পাসওয়ার্ড ভুল হয়েছে। আবার চেষ্টা করুন।";
                submitBtn.innerHTML = `<span>${isSignupMode ? 'সাইন আপ' : 'প্রবেশ করুন'}</span>`;
            } finally {
                submitBtn.disabled = false;
                lucide.createIcons();
            }
        };

        window.handleLogout = async () => {
            try { await signOut(auth); location.reload(); } catch (err) {}
        };

        window.handleWatchAd = async () => {
            const btn = document.getElementById('watch-ad-btn');
            if (!auth.currentUser) return;
            
            btn.disabled = true;
            btn.innerHTML = `<div class="w-12 h-12 border-4 border-primary/20 border-t-primary rounded-full animate-spin mx-auto"></div>`;

            setTimeout(async () => {
                try {
                    const userDocRef = doc(db, 'artifacts', fbAppId, 'users', auth.currentUser.uid, 'profile', 'info');
                    const creditsText = document.getElementById('header-credits').textContent.replace(/,/g, '');
                    const adsText = document.getElementById('stats-ads').textContent;
                    
                    const currentCredits = parseInt(creditsText) || 0;
                    const currentAds = parseInt(adsText) || 0;
                    
                    await updateDoc(userDocRef, {
                        credits: currentCredits + 10,
                        adsWatched: currentAds + 1
                    });
                } finally {
                    btn.disabled = false;
                    btn.innerHTML = `
                        <div class="bg-primary/10 p-5 rounded-full mb-2 group-hover:bg-primary/20 transition-colors"><i data-lucide="play" class="text-primary w-12 h-12 fill-current"></i></div>
                        <span class="text-slate-800 font-black text-xl tracking-tight">ভিডিও দেখুন</span>
                        <span class="text-primary font-bold text-[11px] uppercase tracking-widest">+১০ ক্রেডিট</span>
                    `;
                    lucide.createIcons();
                }
            }, 2000);
        };

        document.getElementById('auth-form').onsubmit = window.handleAuth;

        onAuthStateChanged(auth, async (user) => {
            document.getElementById('loading-screen').classList.add('hidden');
            if (user && !user.isAnonymous) {
                document.getElementById('auth-shell').classList.add('hidden');
                document.getElementById('app-shell').classList.remove('hidden');
                syncUserData(user);
                window.showView('browser');
            } else {
                document.getElementById('auth-shell').classList.remove('hidden');
                document.getElementById('app-shell').classList.add('hidden');
                if(!user) {
                    try { await signInAnonymously(auth); } catch(e) {}
                }
            }
            lucide.createIcons();
        });
    </script>
</body>
</html>
